# M4A転写システム アーキテクチャ設計

## システム概要

M4A音声ファイルをWeb UIでアップロードし、音声転写とAI要約を行うシステム。Google Cloud E2環境でOllamaを使用してローカルAI処理を実行し、個人情報保護とパフォーマンスを両立する。

## アーキテクチャパターン

- **パターン**: Single Page Application (SPA) + RESTful API
- **理由**: 
  - Web UI中心のシンプルなユーザー体験
  - リアルタイム処理状況表示に最適
  - Google Cloud E2の限られたリソースで効率的に動作
  - NIX/UV環境での簡単デプロイに対応

## コンポーネント構成

### フロントエンド
- **フレームワーク**: Vanilla JavaScript + HTML5/CSS3
  - 理由: 軽量、ミニマルフラットデザインに最適、依存関係最小
- **状態管理**: Local Storage + DOM状態管理
- **UI**: ミニマルフラットデザイン（6色パレット、絵文字なし）
- **アクセシビリティ**: WCAG 2.1 AA準拠

### バックエンド
- **フレームワーク**: FastAPI (Python)
  - 理由: 高速、TypeScript型定義生成、非同期処理対応
- **音声処理**: OpenAI Whisper（ローカル実行）
- **AI要約**: Ollama（ローカル実行）
- **認証方式**: JWT Token（セッションベース）

### インフラストラクチャ
- **環境**: Google Cloud E2 (e2-standard-2)
  - vCPU: 2コア
  - メモリ: 8GB RAM
  - ストレージ: 80GB HDD
- **OS**: Ubuntu 20.04 LTS
- **デプロイ**: GitHub Actions + Docker
- **ネットワーク**: HTTPS（TLS暗号化）

### データベース
- **DBMS**: SQLite
  - 理由: 軽量、ローカル処理、バックアップ容易、E2環境に最適
- **キャッシュ**: Redis（オプション）
  - 処理状況の一時保存用

### AIモデル
- **Ollama**: ローカル実行
  - モデル: Llama2-7B（メモリ制約を考慮）
  - 用途: 会議録・面接記録要約生成
  - 自動セットアップ対応

## システム境界

### 含まれる機能
- M4Aファイルアップロード（最大50MB）
- 音声転写（Whisper）
- 用途別AI要約（Ollama）
- リアルタイム進行状況表示
- テキストファイルダウンロード
- エラーハンドリング

### 含まれない機能
- ユーザー認証・認可
- 複数ユーザー管理
- 永続的なデータ保存
- 外部API連携
- リアルタイム音声処理

## セキュリティ設計

### データ保護
- **暗号化**: HTTPS通信、ファイル一時暗号化
- **データ削除**: 処理完了後の自動削除
- **ローカル処理**: 外部API送信なし
- **個人情報**: 最小限の取得・保存

### システムセキュリティ
- **アクセス制御**: IP制限（オプション）
- **ファイル検証**: 形式・サイズ・内容チェック
- **エラーハンドリング**: 情報漏洩防止

## パフォーマンス設計

### 処理時間目標
- **音声転写**: 1時間音声→10分以内
- **AI要約**: 転写結果→5分以内
- **合計処理**: 1時間音声→15分以内

### リソース制約対応
- **メモリ管理**: 8GB制約下でのOllamaモデル選択
- **ストレージ**: 一時ファイル自動削除
- **CPU**: 2コア効率利用（並列処理制限）

## スケーラビリティ

### 現在の制約
- 同時処理: 1ファイルのみ
- ユーザー: 単一セッション
- リソース: Google Cloud E2固定

### 将来的な拡張性
- 水平スケール: 複数インスタンス対応準備
- ストレージ: Cloud Storage移行可能
- AI処理: GPU インスタンス移行可能

## 監視・ログ設計

### ログ出力
- **アプリケーションログ**: 処理状況、エラー情報
- **システムログ**: リソース使用量、パフォーマンス
- **セキュリティログ**: アクセス記録、異常検知

### 監視項目
- CPU・メモリ使用率
- 処理時間・成功率
- エラー発生頻度
- ディスク使用量

## デプロイメント戦略

### 環境構築
1. **NIX/UV環境**: 依存関係自動解決
2. **Docker化**: コンテナベースデプロイ
3. **GitHub Actions**: CI/CD自動化
4. **Ollama自動セットアップ**: 初回起動時

### 設定管理
- **環境変数**: 設定値外部化
- **設定ファイル**: YAML/JSON形式
- **シークレット**: GitHub Secrets管理
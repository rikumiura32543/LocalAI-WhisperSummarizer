# M4A転写システム 要件定義書

## 概要

M4A形式の音声ファイルをWebブラウザ上で転写し、会議録や面接記録として用途に応じたAI要約を生成するシステム。Google Cloud E2 (e2-standard-2)環境でOllamaを使用してローカルAI処理を実行し、NIX/UV環境で簡単に導入・利用できる。ミニマルフラットデザインでアクセシビリティを重視したUIを提供する。

## ユーザストーリー

### ストーリー1: 会議の文字起こしと要約

- **である** プロジェクトマネージャー **として**
- **私は** 会議のM4A音声をWebで転写し、決定事項やアクションプランを要約 **をしたい**
- **そうすることで** 会議後の議事録作成を自動化し、フォローアップを効率化できる

### ストーリー2: 面接記録の自動生成

- **である** 人事担当者 **として**
- **私は** 面接のM4A音声から候補者の評価要約を自動生成 **をしたい**
- **そうすることで** 面接後の評価レポート作成時間を短縮し、客観的な記録を残せる

### ストーリー3: 簡単な環境構築

- **である** 開発チーム **として**
- **私は** NIX/UVを使って簡単にシステムを導入 **をしたい**
- **そうすることで** 複雑な環境構築なしに、どのOSでも同じように動作させられる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムはWebブラウザ上でM4Aファイルのアップロードを受け入れなければならない
- REQ-002: システムは会議または面接の種別選択機能を提供しなければならない
- REQ-003: システムは音声を全文テキストに転写しなければならない
- REQ-004: システムは用途に応じた要約をOllamaローカルAIで生成しなければならない
- REQ-005: システムは全文テキストと要約をWeb上で表示しなければならない
- REQ-006: システムは結果をテキストファイルでダウンロード可能にしなければならない
- REQ-007: システムは処理進行状況をリアルタイムで表示しなければならない

### 条件付き要件

- REQ-101: 会議が選択された場合、システムは決定事項・アクションプラン・会議要約・次回会議内容の要約を生成しなければならない
- REQ-102: 面接が選択された場合、システムは候補者評価・経験・就活の軸・職務経験・キャラクター・次回申し送りの要約を生成しなければならない
- REQ-103: ファイルサイズが50MB以上の場合、システムは分割処理を実行しなければならない
- REQ-104: 音声品質が低い場合、システムは品質改善処理を自動実行しなければならない

### 状態要件

- REQ-201: 処理中の状態にある場合、システムは一時停止・再開機能を提供しなければならない
- REQ-202: エラー状態にある場合、システムは詳細なエラー情報を表示しなければならない
- REQ-203: 待機状態にある場合、システムは処理順序を表示しなければならない

### オプション要件

- REQ-301: システムは話者識別機能を提供してもよい
- REQ-302: システムはタイムスタンプ付きテキストを生成してもよい
- REQ-303: システムは複数の出力形式（TXT、JSON、CSV）を提供してもよい
- REQ-304: システムはファイルごとの処理履歴を保存してもよい
- REQ-305: システムは要約内容のカスタマイズ機能を提供してもよい
- REQ-306: システムはOllamaモデルの手動切り替え機能を提供してもよい

### 制約要件

- REQ-401: システムはNIX/UV環境で動作しなければならない
- REQ-402: システムはMac、Windows、Linuxで同一動作しなければならない
- REQ-403: システムは個人情報保護規則に準拠しなければならない
- REQ-404: システムは処理中の音声データを暗号化しなければならない
- REQ-405: システムは処理完了後に一時ファイルを自動削除しなければならない
- REQ-406: システムはシンプルなコマンドで起動可能でなければならない
- REQ-407: システムはOllamaモデルの自動セットアップを実行しなければならない
- REQ-408: システムはGoogle Cloud E2環境で動作しなければならない
- REQ-409: システムはGithubからの自動デプロイに対応しなければならない

## 非機能要件

### パフォーマンス

- NFR-001: システムは1時間の音声ファイルを15分以内で転写と要約を完了しなければならない
- NFR-002: システムは転写精度90%以上を達成しなければならない
- NFR-003: システムはOllama AI要約の生成に5分以内で応答しなければならない
- NFR-004: システムはWeb UIのレスポンシブデザインで動作しなければならない
- NFR-005: システムはGoogle Cloud E2 (vCPU:2コア、メモリ:8GB)環境で動作しなければならない
- NFR-006: システムは80GB HDDストレージ内で動作しなければならない

### セキュリティ

- NFR-101: システムは音声データの送信時にTLS暗号化を使用しなければならない
- NFR-102: システムは音声データをサーバーローカルで処理し外部送信しないようにしなければならない
- NFR-103: システムは処理完了後に音声データを自動削除しなければならない
- NFR-104: システムはOllamaモデルデータをローカルに保持しなければならない

### ユーザビリティ

- NFR-201: システムはドラッグ&ドロップでファイルアップロードできなければならない
- NFR-202: システムは処理進行状況をプログレスバーで表示しなければならない
- NFR-203: システムはモバイルブラウザでも使用可能でなければならない
- NFR-204: システムはミニマルフラットデザインで直感的なUIで操作できなければならない
- NFR-205: システムは結果をワンクリックでダウンロードできなければならない
- NFR-206: システムはWCAG 2.1 AAアクセシビリティ基準に準拠しなければならない
- NFR-207: システムは絵文字を使用せずテキストのみでUIを構成しなければならない
- NFR-208: システムは指定された6色のカラーパレットのみ使用しなければならない

### 信頼性・保守性

- NFR-301: システムはシンプルなコマンド（nix runまuv run）で起動できなければならない
- NFR-302: システムはドキュメントに準拠した簡単な操作で使用できなければならない
- NFR-303: システムはREADME.mdに利用方法、業務フロー、シーケンス、ソースコード詳細を記載しなければならない

## デザイン仕様書

### ミニマルフラットデザインルール

**基本方針:**
- 影や3D効果を使用しない完全フラットデザイン
- 限定されたカラーパレットのみ使用
- システムフォントでパフォーマンス優先
- WCAG 2.1 AAアクセシビリティ準拠

**カラーパレット:**
```css
/* 必須カラーのみ使用 */
--color-white: #FFFFFF;     /* 背景色 */
--color-black: #222222;     /* テキスト色 */
--color-primary: #4CAF50;   /* アクセント色（明るい緑、視認性向上） */
--color-danger: #D32F2F;    /* 警告色（赤系） */
--color-gray-light: #F5F5F5; /* 薄いグレー */
--color-gray-medium: #E0E0E0; /* 中間グレー */
```

**ボタン設計ルール:**
- 絵文字は一切使用しない（テキストのみ）
- 文字が多いボタンは横長で縦に配置（`btn-full-width`クラス使用）
- プライマリボタン：白文字（`color: var(--color-white)`）で視認性確保
- 通常ボタン：黒文字（`color: var(--color-black)`）
- ホバー時も適切なコントラストを維持

## Edgeケース

### エラー処理

- EDGE-001: 破損したM4Aファイルがアップロードされた場合のエラー表示と再アップロード要求
- EDGE-002: サポート外ファイル形式のアップロード時の適切なメッセージ表示
- EDGE-003: 音声が含まれていないファイルの検出と警告
- EDGE-004: Ollama AIサービスのエラー時のフォールバック処理と再試行
- EDGE-005: 長時間の無音状態があるファイルの処理
- EDGE-006: Ollamaモデルのメモリ不足時のエラーハンドリング

### 境界値テスト

- EDGE-101: ファイルサイズ0bytesおよび最大許容サイズ（50MB）での動作確認
- EDGE-102: 極端に短い音声（5秒未満）の処理と要約生成
- EDGE-103: 非常に長い音声ファイル（3時間以上）の分割処理
- EDGE-104: 異なる音質・BitレートのM4Aファイルでの動作確認

### Web UI固有ケース

- EDGE-201: ブラウザのタブを閉じた際の処理中データの扱い
- EDGE-202: ネットワーク接続不良時のアップロード失敗対応
- EDGE-203: 異なるブラウザ間での動作確認（Chrome、Firefox、Safari）
- EDGE-204: モバイルデバイスでのファイルアップロードとUI表示

### Ollama AI機能固有ケース

- EDGE-301: 会議と面接の選択が間違った場合の再処理機能
- EDGE-302: Ollamaモデルが応答しない場合のタイムアウト処理
- EDGE-303: 要約内容が不適切または不正確な場合のユーザー通知
- EDGE-304: Google Cloud E2のメモリ制約下でのOllamaモデルサイズ選択
- EDGE-305: 複数言語が混在する音声ファイルの処理

## 受け入れ基準

### Web UI機能テスト

- [ ] WebブラウザでのM4Aファイルアップロード機能
- [ ] 会議・面接種別選択ラジオボタンの動作
- [ ] ドラッグ&ドロップアップロード機能
- [ ] ファイル選択ダイアログの表示と選択
- [ ] アップロード進行状況プログレスバー表示
- [ ] 処理中のリアルタイムステータス表示

### 転写・要約機能テスト

- [ ] M4A音声から全文テキストへの変換精度検証
- [ ] 会議用AI要約（決定事項・アクションプラン・会議要約・次回内容）
- [ ] 面接用AI要約（候補者評価・経験・就活軸・職務経験・キャラクター・申し送り）
- [ ] 全文テキストと要約のWeb上表示機能
- [ ] 結果のテキストファイルダウンロード機能
- [ ] エラー処理とユーザー通知機能

### 非機能テスト

- [ ] 処理速度の性能テスト（1時間音声/15分処理）
- [ ] 転写精度の品質テスト（90%以上）
- [ ] Ollama AI要約生成速度テスト（5分以内）
- [ ] レスポンシブデザインテスト（モバイル・タブレット）
- [ ] セキュリティテスト（データ暗号化・自動削除）
- [ ] ユーザビリティテスト（直感的UI・ワンクリック操作）
- [ ] ブラウザ互換性テスト（Chrome・Firefox・Safari）
- [ ] ファイルサイズ制限テスト（50MBまで）

### 環境・統合テスト

- [ ] NIX環境でのアプリケーション起動テスト
- [ ] UV環境でのアプリケーション起動テスト
- [ ] Google Cloud E2環境でのOllamaセットアップテスト
- [ ] Ubuntu 20.04 LTSでの動作テスト
- [ ] クロスプラットフォーム動作確認（Mac・Windows・Linux）
- [ ] エンドツーエンドのユーザーフローテスト
- [ ] 異なるM4Aファイル形式・エンコードでの互換性テスト
- [ ] システムリソース制約下での動作テスト

### 受け入れテスト

- [ ] 実際の会議音声でのOllama要約精度検証
- [ ] 実際の面接音声でのOllama要約精度検証
- [ ] ミニマルフラットデザイン基準遵守確認
- [ ] README.mdに記載された手順での環境構築テスト
- [ ] 業務フローチャートと実装の整合性確認
- [ ] Mermaidシーケンス図と実装の整合性確認
- [ ] ユーザビリティ基準達成確認（直感的操作・簡単導入）
- [ ] WCAG 2.1 AAアクセシビリティ基準適合性確認
- [ ] Githubからの自動デプロイ機能テスト

### ドキュメンテーション確認

- [ ] README.mdに利用方法が明記されている
- [ ] Mermaidを使った業務フロー図が提供されている
- [ ] シーケンス図が提供されている
- [ ] 各ソースコードの詳細が記載されている